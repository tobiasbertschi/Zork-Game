package ch.bbw.zork;import ch.bbw.zork.riddles.Calculate;import ch.bbw.zork.riddles.Guess;import ch.bbw.zork.riddles.Higherlower;import java.util.*;/** * Class Game - the main class of the "Zork" game. * Author: Tobias Bertschi, Yves Huber */public class Game {    private Room lastRoom;    private Parser parser;    private Room currentRoom;    private Room entrance, dining_hall, kitchen, basement, bath, libary, study, forge, armory, prison;    private Timer timer;    private ArrayList<Item> backpack;    private Setup setup;    boolean finished = false;    public Game() {        timer = new Timer();        backpack = new ArrayList<Item>();        parser = new Parser(System.in);        setup = new Setup();        entrance = new Room("the dungeon entrance");        dining_hall = new Room("the gloomy dinging-hall", setup.new_key, setup.guess);        kitchen = new Room("the medieval kitchen", setup.old_key, setup.higherlower1, true, setup.new_key);        basement = new Room("the dank basement");        bath = new Room("the moist bath", setup.key, setup.calculate1);        libary = new Room("the dusty libary", setup.tipp3, setup.higherlower2, true, setup.old_key);        study = new Room("the crammed study", setup.old_sword, setup.calculate2, true, setup.sword);        forge = new Room("the nast forge", setup.tipp1, setup.higherlower3, true, setup.key);        armory = new Room("the rusty armory", setup.sword, setup.calculate3);        prison = new Room("the gruesome prison", setup.tipp2, setup.higherlower4);        entrance.setExits(null, null, dining_hall, null);        dining_hall.setExits(entrance, bath, basement, kitchen);        kitchen.setExits(null, dining_hall, null, null);        basement.setExits(dining_hall, libary, forge, null);        bath.setExits(null, null, null, dining_hall);        libary.setExits(null, study, null, basement);        study.setExits(null, null, null, libary);        forge.setExits(basement, prison, null, armory);        armory.setExits(null, forge, null, null);        prison.setExits(null, null, null, forge);        currentRoom = entrance; // start game entrance    }    /**     * Main play routine.  Loops until end of play.     */    public void play() {        timer.setStarttime(System.currentTimeMillis());        printWelcome();        // Enter the main command loop.  Here we repeatedly read commands and        // execute them until the game is over.        while (!finished) {            Command command = parser.getCommand();            finished = processCommand(command);        }        System.out.println("Thank you for playing.");        System.out.println("Good bye!");    }    private void printWelcome() {        System.out.println();        System.out.println("Welcome to Zork!");        System.out.println("Zork is a simple adventure game.");        System.out.println("Type 'go' and a direction, if you want to change the room.");        System.out.println("Type 'items' if you want to see your items.");        System.out.println("Type 'search' if you want to pick up the item.");        System.out.println("Type 'help' if you need help.");        System.out.println("Type 'quit' if you want to quit the game.");        System.out.println("Type 'back' if you want to go back");        System.out.println();        System.out.println(currentRoom.longDescription());    }    private boolean processCommand(Command command) {        if (command.isUnknown()) {            System.out.println("I don't know what you mean...");            return false;        }        String commandWord = command.getCommandWord();        if (commandWord.equals("help")) {            printHelp();        } else if (commandWord.equals("go")) {            goRoom(command);        } else if (commandWord.equals("quit")) {            if (command.hasSecondWord()) {                System.out.println("Quit what?");            } else {                return true; // signal that we want to quit            }        } else if (commandWord.equals("items")) {            printItems();        } else if (commandWord.equals("search")) {            if (currentRoom.getRiddle() != null) {                if (currentRoom.startRiddle()) {                    pickItems();                    currentRoom.setItem(null);                    currentRoom.setRiddle(null);                }            } else {                System.out.println("There is nothing interesting here!");                System.out.println("");                System.out.println("Your commands are words are:");                System.out.println(parser.showCommands());            }        } else if (commandWord.equals("map")) {            Map.show(currentRoom);        } else if (commandWord.equals("back")) {            back();        }        return false;    }    private void printHelp() {        System.out.println("You are lost.");        System.out.println("Your are alone.");        System.out.println("You wander around in a dungeon.");        System.out.println("You are here to find the old sword.");        System.out.println();        System.out.println("Your command words are:");        System.out.println(parser.showCommands());    }    private void printItems() {        //output all items        System.out.println(toString().toString());        System.out.println("Your command words are:");        System.out.println(parser.showCommands());    }    private void pickItems() {        //Get the Item of the room is there is one        //Start the riddle of the room if there is one        if (currentRoom.getItem() == null) {            System.out.println("This room is empty!");        } else {            backpack.add(currentRoom.getItem());            System.out.println("You picked up " + currentRoom.getItem().getNote());        }        System.out.println("Your commands are words are:");        System.out.println(parser.showCommands());    }    private void back() {        //Move to the last room        if (lastRoom != null) {            currentRoom = lastRoom;            System.out.println(currentRoom.longDescription());        } else {            System.out.println("You can't go back!");        }    }    private void goRoom(Command command) {        if (!command.hasSecondWord()) {            System.out.println("Go where?");        } else {            String direction = command.getSecondWord();            // Try to leave current room.            Room nextRoom = currentRoom.nextRoom(direction);            if (nextRoom == null)                System.out.println("There is no door!");            else {                // Check if room is locked                if (nextRoom.isLocked()) {                    if (nextRoom.unlock(backpack)) {                        System.out.println("You unlocked the door!");                        lastRoom = currentRoom;                        currentRoom = nextRoom;                        System.out.println(currentRoom.longDescription());                    } else {                        System.out.println("You don't have the required item!");                    }                } else if (!nextRoom.isLocked()) {                    lastRoom = currentRoom;                    currentRoom = nextRoom;                    System.out.println(currentRoom.longDescription());                }                if (nextRoom == study) {                    // Get the Item and End the game                    System.out.println("You see the old sword.");                    System.out.println("You have beaten the game.");                    System.out.println("Congratulations");                    timer.setEndtime(System.currentTimeMillis());                    System.out.println("You had " + timer.caluculateTime() + " time to beat the game");                    finished = true;                }            }        }    }    @Override    public String toString() {        String output = "";        for (Item item : backpack) {            if (item.getType() == Item.Types.KEY) {                output += "Type = " + item.getType() + ", " + "Name = " + item.getNote() + "\n";            } else if (item.getType() == Item.Types.PAPER) {                output += "Type = " + item.getType() + ", " + "Description " + item.getDescription() + "\n";            } else if (item.getType() == Item.Types.WEAPON) {                output += "Type = " + item.getType() + ", " + "Name = " + item.getNote() + "," + "Description " + item.getDescription() + "\n";            }        }        return output;    }}